<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mes pages de vente</title>
  <style>
    /* Styles identiques (non modifiés pour clarté) */
    /* ... tout ton CSS ici ... */
  </style>
  <script src="https://www.paypal.com/sdk/js?client-id=AbbM0FEMw_rXOuQ2anllZLqSYikCEsNHG8tw2r-M1J6nkPSHGAFmrSktz6as7AFyomgaMO_MxefyP1dP&currency=EUR"></script>
</head>
<body>
  <img src="ton-logo.png" alt="Mon logo principal" class="main-logo">
  <div class="container">
    <!-- Logos secondaires -->
  </div>

  <!-- Produit -->
  <div class="produit">
    <h2>Mega Booster Pack Magic - 50 cartes</h2>
    <img src="mega-booster.jpg" alt="Mega Booster Pack Magic" />
    <p class="description">
Prix 7€ - Booste ton expérience Magic avec ce pack !

Chaque booster contient 50 cartes (des séries de 2005 à 2025):

🗭 30 cartes communes
🕪 15 cartes uncos
🔸 5 cartes rares ou mythiques garanties
🔁 Aucun doublon

📌 État des cartes : bon à très bon | 📚 Langue : FR

Si tu commandes plus de 2 boosters, une carte rare ou mythique sera ajoutée par booster supplémentaire.
    </p>
    <p>Stock restant : <span id="stockRestant">...</span></p>
    <label for="quantite">Quantité :</label>
    <input type="number" id="quantite" min="1" value="1" />
    <button id="ajouterBtn">Ajouter au panier</button>
  </div>

  <div id="panier">
    <h3>Panier</h3>
    <p>Produit : Mega Booster Pack Magic</p>
    <p>Quantité : <span id="panierQte">0</span></p>
    <p>Total : <span id="panierTotal">0</span> €</p>
    <button id="viderPanierBtn">Vider le panier</button>
    <div id="paypal-button-container" style="margin-top: 15px;"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, getDoc, runTransaction } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCuh-opgGC3rha5j4ptxrZ1RByrx2sV1mA",
      authDomain: "mega-booster-656e5.firebaseapp.com",
      projectId: "mega-booster-656e5",
      storageBucket: "mega-booster-656e5.appspot.com",
      messagingSenderId: "568395965944",
      appId: "1:568395965944:web:cc490bb3ef04f67b9a220d",
      measurementId: "G-0M0FZCRTCJ"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    let stock = 0;
    let panierQte = 0;
    const prixUnitaire = 7;

    const stockSpan = document.getElementById('stockRestant');
    const quantiteInput = document.getElementById('quantite');
    const ajouterBtn = document.getElementById('ajouterBtn');
    const panierDiv = document.getElementById('panier');
    const panierQteSpan = document.getElementById('panierQte');
    const panierTotalSpan = document.getElementById('panierTotal');
    const viderPanierBtn = document.getElementById('viderPanierBtn');

    function majAffichagePanier() {
      if (panierQte > 0) {
        panierDiv.style.display = 'block';
        panierQteSpan.textContent = panierQte;
        panierTotalSpan.textContent = (panierQte * prixUnitaire).toFixed(2);

        // Affiche PayPal
        document.getElementById('paypal-button-container').innerHTML = '';
        paypal.Buttons({
          createOrder: function(data, actions) {
            return actions.order.create({
              purchase_units: [{
                amount: {
                  value: (panierQte * prixUnitaire).toFixed(2)
                }
              }]
            });
          },
          onApprove: async function(data, actions) {
            return actions.order.capture().then(async function(details) {
              const succes = await reduireStock(panierQte);
              if (succes) {
                alert('Merci pour votre achat, ' + details.payer.name.given_name + ' !');
                panierQte = 0;
                majAffichagePanier();
              } else {
                alert("Paiement ok, mais erreur stock. Contacte le support.");
              }
            });
          }
        }).render('#paypal-button-container');
      } else {
        panierDiv.style.display = 'none';
      }
    }

    async function chargerStock() {
      const docRef = doc(db, 'produit', 'mega_booster_pack');
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        stock = docSnap.data().stock;
        miseAJourStockInterface();
      } else {
        stockSpan.textContent = "N/A";
        alert("Produit non trouvé dans la base !");
      }
    }

    function miseAJourStockInterface() {
      stockSpan.textContent = stock;
      quantiteInput.max = stock;
      quantiteInput.value = stock > 0 ? 1 : 0;
      ajouterBtn.disabled = stock === 0;
    }

    async function reduireStock(qte) {
      const docRef = doc(db, 'produit', 'mega_booster_pack');
      try {
        await runTransaction(db, async (transaction) => {
          const docSnap = await transaction.get(docRef);
          if (!docSnap.exists()) throw "Produit non trouvé dans la transaction !";
          const currentStock = docSnap.data().stock;
          if (currentStock < qte) throw `Stock insuffisant. Stock actuel : ${currentStock}`;
          transaction.update(docRef, { stock: currentStock - qte });
          stock = currentStock - qte;
        });
        miseAJourStockInterface();
        return true;
      } catch (e) {
        alert(e);
        return false;
      }
    }

    ajouterBtn.addEventListener('click', () => {
      const qte = parseInt(quantiteInput.value);
      if (qte > 0 && qte <= stock) {
        panierQte += qte;
        majAffichagePanier();
      } else {
        alert("Quantité invalide ou stock insuffisant.");
      }
    });

    viderPanierBtn.addEventListener('click', () => {
      panierQte = 0;
      majAffichagePanier();
    });

    chargerStock();
  </script>
</body>
</html>
